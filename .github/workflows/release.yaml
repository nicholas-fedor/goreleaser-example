name: Release

on:
  # Manual runs
  workflow_dispatch:
  # Tag pushes (e.g., v1.2.3)
  push:
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+" # Semantic version tags

jobs:
  # Build binaries, images, SBOMs, and attestations
  build:
    name: Build the Release
    permissions:
      contents: write
      packages: write
      attestations: write
      id-token: write
    secrets: inherit
    uses: ./.github/workflows/build.yaml
    with:
      project_name: goreleaser-example
      # docker_namespace: nickfedor
      ghcr_namespace: nicholas-fedor

  # manifest:
  #   name: Create image manifests
  #   needs: build
  #   permissions:
  #     contents: read # For code checkout
  #     packages: write # For pushing manifests
  #   secrets: inherit
  #   uses: ./.github/workflows/create-manifests.yaml
  #   with:
  #     version: ${{ github.ref_name }} # Tag name (e.g., v1.2.3)
  #     project_name: goreleaser-example
  #     # docker_namespace: nickfedor
  #     ghcr_namespace: nicholas-fedor
